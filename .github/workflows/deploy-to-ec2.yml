name: Deploy to EC2

on:
  workflow_dispatch: 

env:
  EC2_HOST: ${{ secrets.EC2_HOST }}
  EC2_USER: ${{ secrets.EC2_USER }}

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production 

    steps:
    - name: Prepare SSH key
      run: |
        echo "${{ secrets.EC2_SSH_KEY }}" | base64 -d > private_key.pem
        chmod 600 private_key.pem

    - name: Execute deploy script on EC2
      run: |
        ssh -o StrictHostKeyChecking=no \
            -i private_key.pem \
            $EC2_USER@$EC2_HOST \
            "bash /home/ec2-user/deploy.sh"
